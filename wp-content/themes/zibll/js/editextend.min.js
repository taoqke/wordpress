(function(t){function n(n,e,o){var a=new FormData,c="mce_notice",s="upload_ing";a.append("file",n,n.name),a.append("action","edit_upload"),i("正在上传请稍候...","load","",c),e.data(s,!0),t.ajax({type:"POST",url:mce.ajax_url,data:a,processData:!1,contentType:!1,dataType:"json",error:function(t){var n="操作失败 "+t.status+" "+t.statusText+"，请刷新页面后重试";t.responseText&&t.responseText.indexOf("致命错误")>-1&&(n="网站遇到致命错误，请检查插件冲突或通过错误日志排除错误"),i(n,"danger",3,c),e.data(s,!1)},success:function(n){var a=n.ys?n.ys:n.error?"danger":"";i(n.msg||"上传成功",a,2,c),t.isFunction(o)&&o(n,e),e.data(s,!1)}})}function e(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function i(n,e,i,o){function a(t){t.addClass("notyn-out"),setTimeout(function(){t.remove()},1e3)}t(".notyn").length||t("body").append('<div class="notyn"></div>'),e=e||"success",i=i||5e3,i=i<100?1e3*i:i;var c=o?' id="'+o+'"':"",s=t('<div class="noty1"'+c+'><div class="notyf '+e+'">'+n+"</div></div>"),d=!o;o&&t("#"+o).length?(t("#"+o).find(".notyf").removeClass().addClass("notyf "+e).html(n),s=t("#"+o),d=!0):t(".notyn").append(s),d&&setTimeout(function(){a(s)},i)}var o=tinymce.PluginManager.add;o("zib_hide",function(t,n){t.addButton("zib_hide",{text:"",icon:"preview",tooltip:"隐藏内容",type:"menubutton",menu:[{text:"评论后可查看",onclick:function(){t.selection.setContent('<span>[hidecontent type="reply" desc="隐藏内容：评论后查看"]</span><p>'+t.selection.getContent()+"</p><span>[/hidecontent]</span>")}},{text:"登录后可查看",onclick:function(){t.selection.setContent('<span>[hidecontent type="logged" desc="隐藏内容：登录后可查看"]</span><p>'+t.selection.getContent()+"</p><span>[/hidecontent]</span>")}},{text:"会员可查看",onclick:function(){t.selection.setContent('<span>[hidecontent type="vip1" desc="隐藏内容：会员可查看"]</span><p>'+t.selection.getContent()+"</p><span>[/hidecontent]</span>")}}]})}),o("zib_quote",function(t,n){t.addButton("zib_quote",{text:"",icon:"blockquote",tooltip:"引言",type:"menubutton",menu:[{text:"灰色",onclick:function(){t.selection.setContent('<div class="quote_q"><i class="fa fa-quote-left"></i><p>'+(t.selection.getContent()||"<br/>")+"</p></div>")}},{text:"红色",onclick:function(){t.selection.setContent('<div class="quote_q qe_wzk_c-red"><i class="fa fa-quote-left"></i><p>'+(t.selection.getContent()||"<br/>")+"</p></div>")}},{text:"蓝色",onclick:function(){t.selection.setContent('<div class="quote_q qe_wzk_lan"><i class="fa fa-quote-left"></i><p>'+(t.selection.getContent()||"<br/>")+"</p></div>")}},{text:"绿色",onclick:function(){t.selection.setContent('<div class="quote_q qe_wzk_lv"><i class="fa fa-quote-left"></i><p>'+(t.selection.getContent()||"<br/>")+"</p></div>")}}]})}),o("zib_img",function(i,o){var a=t('<input type="file" accept="image/gif,image/jpeg,image/jpg,image/png">');a.on("change",function(e){var o=this.files||e.dataTransfer.files,a="upload_ing";if(o[0]&&!t(this).data(a)){var c=o[0],s=mce.img_max||4;if(c.size>1024e3*s)return notyf("文件["+c.name+"]大小超过限制，最大"+s+"M，请重新选择","danger");n(c,t(this),function(t){t.img_url&&i.insertContent('<img src="'+t.img_url+'" alt="'+c.name+'"><p></p>')})}}),i.addButton("zib_img",{text:"",icon:"image",tooltip:"上传图片",onclick:function(){e()||a.click()},onTouchEnd:function(){e()&&a.click()}})}),o("zib_video",function(i,o){var a=t('<input type="file" accept="video/*">');a.on("change",function(e){var o=this.files||e.dataTransfer.files,a="upload_ing";if(o[0]&&!t(this).data(a)){var c=o[0],s=mce.video_max||30;if(c.size>1024e3*s)return notyf("文件["+c.name+"]大小超过限制，最大"+s+"M，请重新选择","danger");n(c,t(this),function(t){t.url&&i.insertContent('<div contenteditable="false" data-video-url="'+t.url+'" class="new-dplayer post-dplayer dplayer"><span>[视频:'+c.name+"]</span></div><p></p>")})}}),i.addButton("zib_video",{text:"",tooltip:"上传视频",icon:"media",onclick:function(){e()||a.click()},onTouchEnd:function(){e()&&a.click()}})})})(jQuery);