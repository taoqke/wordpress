function ajax_slidercaptcha(t,e){if($(".slidercaptcha").length){$('a[href="#tab-slidercaptcha"]').tab("show");var i=!1;e&&e.parents(".tab-pane").each(function(t){$(this).siblings(".slidercaptcha-tab").length&&(i=$(this).attr("id"))}),i&&$(".slidercaptcha-back").attr("href","#"+i).fadeIn(),$(".slidercaptcha").sliderCaptcha({onSuccess:function(i){_win.slidercaptcha=i,$.isFunction(t)&&t(e)},setSrc:function(){return _win.uri+"/img/captcha/"+Math.round(20*Math.random())+".jpg"}})}}(function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("lgb.SliderCaptcha"),s="object"==typeof e&&e;o&&!/reset/.test(e)&&t(o.refreshIcon).click(),o||n.data("lgb.SliderCaptcha",o=new i(this,s)),"string"==typeof e&&o[e]()})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.$element.css({position:"relative",width:this.options.width+"px",margin:"0 auto"}),this.init()};i.DEFAULTS={width:270,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:8,loadingText:'<i class="loading mr6"></i>加载中...',failedText:"请再试一次",barText:"向右滑动填充拼图",repeatIcon:"fa fa-refresh",maxLoadCount:3,onFail:function(){},onSuccess:function(){},setSrc:function(){return""}},t.fn.sliderCaptcha=e,t.fn.sliderCaptcha.Constructor=i;var n=i.prototype;n.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},n.initDOM=function(){var e=function(t,e){var i=document.createElement(t);return i.className=e,i},i=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},n=i(this.options.width-2,this.options.height),o=n.cloneNode(!0),s=e("div","sliderContainer"),a=e("botton","refreshIcon "+this.options.repeatIcon),r=e("div","sliderMask"),c=e("div","captcha-slider"),l=e("i","fa fa-chevron-right sliderIcon"),h=e("span","sliderText");n.className="captcha-body-bg placeholder",o.className="captcha-body-bar",h.innerHTML=this.options.barText;var d=this.$element;d.html(t(n)),d.append(t(a)),d.append(t(o)),c.appendChild(l),s.appendChild(r),s.appendChild(c),s.appendChild(h),d.append(t(s));var p={canvas:n,block:o,sliderContainer:t(s),refreshIcon:a,slider:c,sliderMask:r,sliderIcon:l,text:t(h),canvasCtx:n.getContext("2d"),blockCtx:o.getContext("2d")};t.isFunction(Object.assign)?Object.assign(this,p):t.extend(this,p)},n.initImg=function(){var e=this,i=window.navigator.userAgent.indexOf("Trident")>-1,n=this.options.sliderL+2*this.options.sliderR+3,o=function(t,n){var o=e.options.sliderL,s=e.options.sliderR,a=e.options.PI,r=e.x,c=e.y;t.beginPath(),t.moveTo(r,c),t.arc(r+o/2,c-s+2,s,.72*a,2.26*a),t.lineTo(r+o,c),t.arc(r+o+s-2,c+o/2,s,1.21*a,2.78*a),t.lineTo(r+o,c+o),t.lineTo(r,c+o),t.arc(r+s-2,c+o/2,s+.4,2.76*a,1.24*a,!0),t.lineTo(r,c),t.lineWidth=2,t.fillStyle="rgba(100, 100, 100, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.5)",t.stroke(),t[n](),t.globalCompositeOperation=i?"xor":"destination-over"},s=function(t,e){return Math.round(Math.random()*(e-t)+t)},a=new Image;a.crossOrigin="Anonymous";var r=0;a.onload=function(){e.x=s(n+10,e.options.width-(n+10)),e.y=s(10+2*e.options.sliderR,e.options.height-(n+10)),o(e.canvasCtx,"fill"),o(e.blockCtx,"clip"),e.canvasCtx.drawImage(a,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(a,0,0,e.options.width-2,e.options.height);var t=e.y-2*e.options.sliderR-1,i=e.blockCtx.getImageData(e.x-3,t,n,n);e.block.width=n,e.blockCtx.putImageData(i,0,t+1),e.text.text(e.text.attr("data-text"))},a.onerror=function(t){if(r++,r>=e.options.maxLoadCount)return e.text.text("加载失败").addClass("text-danger c-red"),void e.canvas.removeClass("placeholder");a.localImages()},a.setSrc=function(){if(r=0,e.text.removeClass("text-danger"),t.isFunction(e.options.setSrc)){var i=e.options.setSrc();i?a.src=e.options.setSrc():a.localImages()}},a.localImages=function(){e.text.removeClass("text-danger");var t="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(20*Math.random());if(i){var n=new XMLHttpRequest;n.onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){a.src=t.target.result}},n.open("GET",t),n.responseType="blob",n.send()}else a.src=t},a.setSrc(),this.text.attr("data-text",this.options.barText),this.text.html(this.options.loadingText),this.img=a},n.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},n.bindEvents=function(){var e=this;this.$element.on("selectstart",function(){return!1}),t(this.refreshIcon).on("click",function(){e.text.text(e.options.barText),e.reset(),t.isFunction(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var i,n,o,s,a=[],r=!1;this.$element.on("touchstart pointerdown MSPointerDown",".captcha-slider",function(t){e.text.hasClass("text-danger")||(i=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,n=t.originalEvent.pageY||t.originalEvent.touches[0].pageY,r=!0)}).on("touchmove pointermove MSPointerMove",function(t){if(r){var c=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,l=t.originalEvent.pageY||t.originalEvent.touches[0].pageY;if(o=c-i,s=l-n,o>=0&&o+40<=e.options.width){t.preventDefault?t.preventDefault():t.returnValue=!1,e.slider.style.left=o-1+"px";var h=(e.options.width-40-20)/(e.options.width-40)*o;e.block.style.left=h+"px",e.sliderContainer.addClass("sliderContainer_active"),e.sliderMask.style.width=o+4+"px",a.push(Math.round(s))}}}).on("touchend touchcancel pointerup MSPointerUp",function(i){if(r&&o>=0){e.sliderContainer.removeClass("sliderContainer_active"),e.trail=a;var n=e.verify();n.spliced&&n.verified?(e.sliderContainer.addClass("sliderContainer_success"),t.isFunction(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,n)):(e.sliderContainer.addClass("sliderContainer_fail"),t.isFunction(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.text(e.options.failedText),e.reset()},500))}o=0,s=0,r=!1})},n.verify=function(){var t=this.trail,e=parseInt(this.block.style.left),i=!1,n=function(t,e){return t+e},o=function(t){return t*t},s=t.reduce(n)/t.length,a=t.map(function(t){return t-s}),r=Math.sqrt(a.map(o).reduce(n)/t.length);return i=0!==r,{spliced:Math.abs(e-this.x)<this.options.offset,trail:t,verified:i}},n.reset=function(){this.sliderContainer.removeClass("sliderContainer_fail sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.attr("data-text",this.text.text()),this.text.html(this.options.loadingText),this.img.setSrc()}})(jQuery),_win.slidercaptcha=!1;